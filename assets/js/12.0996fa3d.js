(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{273:function(t,s,e){"use strict";e.r(s);var a=e(0),r=Object(a.a)({},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),e("p",[t._v("网上的教程也是蛮多的，这里记录下一些要点和注意事项。")]),t._v(" "),e("ul",[e("li",[t._v("主要参考\n"),e("ul",[e("li",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.5/en/replication-howto.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方文档"),e("OutboundLink")],1)]),t._v(" "),e("li",[e("a",{attrs:{href:"https://www.cnblogs.com/gl-developer/p/6170423.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("MySQL主从复制(Master-Slave)实践"),e("OutboundLink")],1)])])])]),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.5/en/replication-howto-masterbaseconfig.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("主库配置"),e("OutboundLink")],1),t._v(" "),e("ul",[e("li",[t._v("备份数据库（可选操作，避免手贱误操作的后悔药）")]),t._v(" "),e("li",[t._v("配置server-id")]),t._v(" "),e("li",[t._v("记录二进制日志文件名和位置")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.5/en/replication-howto-repuser.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("创建用于读取日志的账号"),e("OutboundLink")],1),t._v("（可选操作，也可以用root账号，实际生产建议新建账号）")])])]),t._v(" "),e("li",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.5/en/replication-howto-slavebaseconfig.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("从库配置"),e("OutboundLink")],1),t._v(" "),e("ul",[e("li",[t._v("还原备份，如果有的话（保持数据库状态一致）")]),t._v(" "),e("li",[t._v("配置server-id")]),t._v(" "),e("li",[e("a",{attrs:{href:"https://dev.mysql.com/doc/refman/5.5/en/replication-howto-slaveinit.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置主数据库信息和日志信息"),e("OutboundLink")],1)]),t._v(" "),e("li",[t._v("启动slave服务")])])])]),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._m(12),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._m(17),t._v(" "),t._m(18),t._m(19),t._v(" "),t._m(20),t._m(21),t._v(" "),t._m(22),t._v(" "),t._m(23),t._v(" "),t._m(24)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"mysql主从数据库配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mysql主从数据库配置","aria-hidden":"true"}},[this._v("#")]),this._v(" Mysql主从数据库配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"软硬件环境"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#软硬件环境","aria-hidden":"true"}},[this._v("#")]),this._v(" 软硬件环境")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("table",[e("thead",[e("tr",[e("th",[t._v("Master机")]),t._v(" "),e("th",[t._v("Slave机")])])]),t._v(" "),e("tbody",[e("tr",[e("td",[t._v("win10虚拟机")]),t._v(" "),e("td",[t._v("win10开发机")])]),t._v(" "),e("tr",[e("td",[t._v("win7")]),t._v(" "),e("td",[t._v("win10开发机")])]),t._v(" "),e("tr",[e("td",[t._v("win server 2008 r2服务器")]),t._v(" "),e("td",[t._v("win server 2008 r2服务器")])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("试过Master机、Slave机不同组合都可以实现，所以跟系统环境关系不大。")]),this._v(" "),s("li",[this._v("MySql使用的版本是5.5.*。尽量保持版本一致，否则新版数据库的sql语句可能在旧版数据库执行失败。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"主从配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主从配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 主从配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"配置文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置文件","aria-hidden":"true"}},[this._v("#")]),this._v(" 配置文件")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("win上配置文件可能是"),s("code",[this._v("my.ini")]),this._v("，linux上可能是"),s("code",[this._v("my.cnf")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"主库配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主库配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 主库配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("备份数据库，如果都是新库，不用备份。如果需要备份，可以输出sql文件，也可以锁表直接拷贝数据库文件。")]),this._v(" "),s("li",[this._v("修改配置")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mysqld"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nlog-bin"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mysql-bin "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#开启二进制日志")]),t._v("\nserver-id"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1 "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置server-id")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 不同步的数据库")]),t._v("\nbinlog-ignore-db "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mysql\nbinlog-ignore-db "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要同步的数据库")]),t._v("\nbinlog-do-db "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" mytest\n")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[t._v("重启后配置生效，记录日志信息\n"),e("ul",[e("li",[t._v("打开命令窗口，执行"),e("code",[t._v("mysql -h localhost -u root -p")]),t._v("进行登陆")]),t._v(" "),e("li",[t._v("登陆后执行"),e("code",[t._v("SHOW MASTER STATUS;")]),t._v("，记录日志文件名和位置")])])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("mysql "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" SHOW MASTER STATUS"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n+------------------+----------+--------------+------------------+\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" File             "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Position "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Binlog_Do_DB "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" Binlog_Ignore_DB "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+------------------+----------+--------------+------------------+\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" mysql-bin.000003 "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" 107      "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" mytest       "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" mysql,test       "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("\n+------------------+----------+--------------+------------------+\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("创建用户，用于同步，给从库登陆读取日志用")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("mysql"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" CREATE USER "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'repl'")]),t._v("@"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.209.129'")]),t._v(" IDENTIFIED BY "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'repl123456'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#创建用户")]),t._v("\nmysql"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" GRANT REPLICATION SLAVE ON *.* TO "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'repl'")]),t._v("@"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.209.129'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#分配权限")]),t._v("\nmysql"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("flush privileges"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#刷新权限")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"从库配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#从库配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 从库配置")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("恢复备份，为的就是保持数据一致性，都是新库就不用恢复啦")])]),this._v(" "),s("li",[s("p",[this._v("修改配置")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mysqld"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nserver-id"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("2 "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置server-id")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#要同步的mstest数据库")]),t._v("\nreplicate-do-db"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mytest\nreplicate-do-db"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("daystatis\nreplicate-do-db"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("hourstatis\nreplicate-do-db"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("minstatis\nreplicate-do-db"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("monthstatis\nreplicate-do-db"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("yearstatis\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#要忽略的数据库")]),t._v("\nreplicate-ignore-db"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("mysql\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("重启mysql服务后上述配置生效。命令行登陆数据库后，执行同步配置")])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[t._v("mysql-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("change master to master_host"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'192.168.209.129'")]),t._v(",master_user"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'repl'")]),t._v(",master_password"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'repl123456'")]),t._v(",master_port"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("3306,master_log_file"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mysql-bin.000003'")]),t._v(",master_log_pos"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("107"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[e("p",[t._v("开始同步及查看状态")]),t._v(" "),e("ul",[e("li",[t._v("开始同步之后，从库IO进程根据配置连接主库获取日志文件，拿回来放到中继日志。SQL进程执行中继日志中的sql，完成同步。执行sql至关重要，数据状态不一致可能会导致执行出错，同步失败。")]),t._v(" "),e("li",[t._v("查看状态，"),e("code",[t._v("Slave_IO_Running")]),t._v("和"),e("code",[t._v("Slave_SQL_Running")]),t._v("状态为"),e("code",[t._v("yes")]),t._v("为状态正常。")]),t._v(" "),e("li",[t._v("如果有一个状态不是"),e("code",[t._v("yes")]),t._v("，同步失败，"),e("code",[t._v("Last_Error")]),t._v("记录错误信息，停止同步，排查问题之后，重复执行从库配置步骤即可。")])])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开始同步")]),t._v("\nmysql-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("start slave"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 查看同步状态")]),t._v("\nmysql-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("show slave status\\G"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 停止同步")]),t._v("\nmysql-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("stop slave"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"经验分享和注意事项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#经验分享和注意事项","aria-hidden":"true"}},[this._v("#")]),this._v(" 经验分享和注意事项")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ul",[e("li",[t._v("Master库开启二进制日志，操作数据库的语句都记录在日志，Slave库IO进程从指定位置开始读取日志过来，SQL进程读取日志的SQl语句，再执行一次，就把数据同步过来了。两个进程随便挂一个都会导致同步中断，一般是SQL进程容易挂，执行SQL语句的时候出错。")]),t._v(" "),e("li",[t._v("Master库情况可能是新安装，没使用过，然后开启二进制日志，日志记录了创建表的语句，所以Slave库事先不用创建库表。")]),t._v(" "),e("li",[t._v("如果Master库已经投入使用，源源不断在产生数据了，这时候开启二进制日志，只有插入语句，没有创建表语句，Slave库同步的时候执行插入语句，往不存在的库表插入式数据当然会报错。")]),t._v(" "),e("li",[t._v("所以上面这种情况，在配置好Master库，可选的停止Master库的操作，将备份还原到Slave库，保证两边状态一致，期间不操作数据库。待到Slave库配置好之后再开启Master库，此后的操作都将同步成功，不太可能出错。看情况选择锁表，只读不能写，或者直接停止服务，看大家是自己玩还是生产环境，怎么方便怎么来，怎么安全怎么来，最重要的是我们学会和理解这些操作，灵活使用。")]),t._v(" "),e("li",[t._v("如果不停止Master库，并且源源不断有数据入库，"),e("strong",[t._v("从Master库导出备份后再开启二进制日志")]),t._v("，要及时记录开启日志后的位置，否则等写入一些数据之后在记录日志位置就少同步一部分数据了。Master库开启二进制日志并马上记录日志位置，还原备份之后，配置Slave库后开始同步从记录的位置之后的数据，中间就会缺少备份完成到记录日志位置的这段操作。如果缺少的部分恰好是创建表操作，备份又没有包含创建的表，这时候同步或者之后同步的操作中包含对新表的操作就会出错。")]),t._v(" "),e("li",[t._v("Slave库中同步的表不能再进行写入操作，否则可能会跟同步的操作冲突，破坏一致性，造成同步失败。比如Slave库表插入一条id为3的记录，同步的时候也有插入id为3的记录，就会造成主键重复，也导致同步失败。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"总结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[this._v("#")]),this._v(" 总结")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("别人写的教程可能会有错漏，操作的时候多个心眼，最好根据官方文档来，理解了再做，避免误操作发生“删库跑路”的意外。")])])}],!1,null,null,null);s.default=r.exports}}]);