# 微信支付

## 支付介绍与流程

- 微信支付文档 https://pay.weixin.qq.com/wiki/doc/api/native.php?chapter=6_5
- 以扫码支付为例，倒着讲。以下服务端均指咱们自己的服务器服务端
- 扫描二维码支付之前，服务端需要调用微信下单的 api，得到二维码 url，这一步需要注意几个参数：

| 字段名      | 变量名 | 必填 | 类型       | 示例值                           | 描述                                                    |
| ----------- | ------ | ---- | ---------- | -------------------------------- | ------------------------------------------------------- |
| 公众账号 ID | appid  | 是   | String(32) | wxd678efh567hg6787               | 微信支付分配的公众账号 ID（企业号 corpid 即为此 appId） |
| 商户号      | mch_id | 是   | String(32) | 1230000109                       | 微信支付分配的商户号                                    |
| 签名        | sign   | 是   | String(32) | C380BEC2BFD727A4B6845133519F3AD6 | 通过签名算法计算得出的签名值，详见签名生成算法          |

- url 做成二维码，微信扫描支付成功后，微信提示支付成功，微信异步通知服务端，服务端收到通知回复收到了，收不到自行查询订单信息，最后修改订单状态
- 大部分流程均基于此流程，其中扫码支付的模式一，是由用户扫静态二维码微信通知服务端发起的下单请求，以上流程是用户主动请求服务端发起下单请求，其他模式均可借鉴，目的都是让服务端向微信发起下单请求
- 另一差异就是支付的差异，下单后都得到了 url，可生成二维码供微信客户端扫描，即扫码支付。此链接直接在微信内打开，直接调用支付，即小程序、公众号等支付。手机 app 或者 h5 支付则是唤起微信客户端调用支付
- 相关时序图参考开发文档
