<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>appveyor docker 镜像制作 | xxred&#39;s notes</title>
    <meta name="description" content="记录学习过程，收集学习资源">
    <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3ab1ff">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/logo.jpg">
  <meta name="msapplication-TileImage" content="/logo.jpg">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.5203916d.css" as="style"><link rel="preload" href="/assets/js/app.8290a16a.js" as="script"><link rel="preload" href="/assets/js/2.968fe051.js" as="script"><link rel="preload" href="/assets/js/43.5137f653.js" as="script"><link rel="prefetch" href="/assets/js/10.44142c8c.js"><link rel="prefetch" href="/assets/js/100.fa01a89c.js"><link rel="prefetch" href="/assets/js/101.829be5e7.js"><link rel="prefetch" href="/assets/js/102.593a0911.js"><link rel="prefetch" href="/assets/js/103.c435d4df.js"><link rel="prefetch" href="/assets/js/104.c61abbb5.js"><link rel="prefetch" href="/assets/js/105.2bf5fe07.js"><link rel="prefetch" href="/assets/js/106.cd2fd480.js"><link rel="prefetch" href="/assets/js/107.a916822b.js"><link rel="prefetch" href="/assets/js/108.0cba454b.js"><link rel="prefetch" href="/assets/js/109.a383b2dc.js"><link rel="prefetch" href="/assets/js/11.9545e68d.js"><link rel="prefetch" href="/assets/js/110.70d280ad.js"><link rel="prefetch" href="/assets/js/111.7bdc49be.js"><link rel="prefetch" href="/assets/js/112.fbda4da3.js"><link rel="prefetch" href="/assets/js/113.cbe75f0b.js"><link rel="prefetch" href="/assets/js/114.58d7e344.js"><link rel="prefetch" href="/assets/js/115.d1d8f294.js"><link rel="prefetch" href="/assets/js/116.791e7b4c.js"><link rel="prefetch" href="/assets/js/117.bb3f938a.js"><link rel="prefetch" href="/assets/js/118.f2954a67.js"><link rel="prefetch" href="/assets/js/119.3ca66aea.js"><link rel="prefetch" href="/assets/js/12.1be4fee6.js"><link rel="prefetch" href="/assets/js/120.344b5233.js"><link rel="prefetch" href="/assets/js/121.ee98d672.js"><link rel="prefetch" href="/assets/js/122.d2208130.js"><link rel="prefetch" href="/assets/js/123.3987dd76.js"><link rel="prefetch" href="/assets/js/124.0d72af62.js"><link rel="prefetch" href="/assets/js/125.77cad016.js"><link rel="prefetch" href="/assets/js/13.857ab341.js"><link rel="prefetch" href="/assets/js/14.c28e39fe.js"><link rel="prefetch" href="/assets/js/15.6a2c93b5.js"><link rel="prefetch" href="/assets/js/16.7f1e8b6a.js"><link rel="prefetch" href="/assets/js/17.6b0e06d7.js"><link rel="prefetch" href="/assets/js/18.c57c8642.js"><link rel="prefetch" href="/assets/js/19.dc1a29f1.js"><link rel="prefetch" href="/assets/js/20.402aeb57.js"><link rel="prefetch" href="/assets/js/21.c81d018f.js"><link rel="prefetch" href="/assets/js/22.5e4672e3.js"><link rel="prefetch" href="/assets/js/23.4cef000b.js"><link rel="prefetch" href="/assets/js/24.3a829f0e.js"><link rel="prefetch" href="/assets/js/25.d957ac03.js"><link rel="prefetch" href="/assets/js/26.cc1c6e83.js"><link rel="prefetch" href="/assets/js/27.60abf10d.js"><link rel="prefetch" href="/assets/js/28.9d8a1907.js"><link rel="prefetch" href="/assets/js/29.90c16c9a.js"><link rel="prefetch" href="/assets/js/3.fb6ecb76.js"><link rel="prefetch" href="/assets/js/30.a4af176c.js"><link rel="prefetch" href="/assets/js/31.3e1cf8e9.js"><link rel="prefetch" href="/assets/js/32.52d3d05c.js"><link rel="prefetch" href="/assets/js/33.6e9e2cba.js"><link rel="prefetch" href="/assets/js/34.ef596089.js"><link rel="prefetch" href="/assets/js/35.2a633b20.js"><link rel="prefetch" href="/assets/js/36.0481fffe.js"><link rel="prefetch" href="/assets/js/37.f97385f8.js"><link rel="prefetch" href="/assets/js/38.61a460f9.js"><link rel="prefetch" href="/assets/js/39.b6a34a6e.js"><link rel="prefetch" href="/assets/js/4.9db1ddbb.js"><link rel="prefetch" href="/assets/js/40.3c3a7b30.js"><link rel="prefetch" href="/assets/js/41.414a203c.js"><link rel="prefetch" href="/assets/js/42.fa35959e.js"><link rel="prefetch" href="/assets/js/44.106a53d3.js"><link rel="prefetch" href="/assets/js/45.b4b888e5.js"><link rel="prefetch" href="/assets/js/46.1c9d3065.js"><link rel="prefetch" href="/assets/js/47.5b8fe47c.js"><link rel="prefetch" href="/assets/js/48.e57bc9c4.js"><link rel="prefetch" href="/assets/js/49.92e019b8.js"><link rel="prefetch" href="/assets/js/5.509d06a8.js"><link rel="prefetch" href="/assets/js/50.4bb6bec9.js"><link rel="prefetch" href="/assets/js/51.1db9ee02.js"><link rel="prefetch" href="/assets/js/52.8de1bc76.js"><link rel="prefetch" href="/assets/js/53.a86cc3ca.js"><link rel="prefetch" href="/assets/js/54.4b1b42b7.js"><link rel="prefetch" href="/assets/js/55.600a1096.js"><link rel="prefetch" href="/assets/js/56.a6c41d15.js"><link rel="prefetch" href="/assets/js/57.cd83dffd.js"><link rel="prefetch" href="/assets/js/58.700c6a83.js"><link rel="prefetch" href="/assets/js/59.e809e8ea.js"><link rel="prefetch" href="/assets/js/6.db0e0a89.js"><link rel="prefetch" href="/assets/js/60.badd14ad.js"><link rel="prefetch" href="/assets/js/61.65d73c38.js"><link rel="prefetch" href="/assets/js/62.3a722109.js"><link rel="prefetch" href="/assets/js/63.1d3d8ad9.js"><link rel="prefetch" href="/assets/js/64.161f74d6.js"><link rel="prefetch" href="/assets/js/65.aa0c3c44.js"><link rel="prefetch" href="/assets/js/66.5b8023e0.js"><link rel="prefetch" href="/assets/js/67.aea5063a.js"><link rel="prefetch" href="/assets/js/68.4c088c34.js"><link rel="prefetch" href="/assets/js/69.9ec647ff.js"><link rel="prefetch" href="/assets/js/7.2da78329.js"><link rel="prefetch" href="/assets/js/70.03603f48.js"><link rel="prefetch" href="/assets/js/71.14395698.js"><link rel="prefetch" href="/assets/js/72.a6d346ff.js"><link rel="prefetch" href="/assets/js/73.444d27b0.js"><link rel="prefetch" href="/assets/js/74.8d93b5d2.js"><link rel="prefetch" href="/assets/js/75.3b745354.js"><link rel="prefetch" href="/assets/js/76.f2512890.js"><link rel="prefetch" href="/assets/js/77.75b871c9.js"><link rel="prefetch" href="/assets/js/78.c87d124e.js"><link rel="prefetch" href="/assets/js/79.1b113212.js"><link rel="prefetch" href="/assets/js/8.92ec3027.js"><link rel="prefetch" href="/assets/js/80.f911fee7.js"><link rel="prefetch" href="/assets/js/81.0e19d377.js"><link rel="prefetch" href="/assets/js/82.5242e457.js"><link rel="prefetch" href="/assets/js/83.309da3af.js"><link rel="prefetch" href="/assets/js/84.42371abf.js"><link rel="prefetch" href="/assets/js/85.73abd118.js"><link rel="prefetch" href="/assets/js/86.f4e9719d.js"><link rel="prefetch" href="/assets/js/87.4cebdacb.js"><link rel="prefetch" href="/assets/js/88.c4b91f07.js"><link rel="prefetch" href="/assets/js/89.f03c78a5.js"><link rel="prefetch" href="/assets/js/9.a83adfd8.js"><link rel="prefetch" href="/assets/js/90.0574bd2c.js"><link rel="prefetch" href="/assets/js/91.7f902e2b.js"><link rel="prefetch" href="/assets/js/92.72b15497.js"><link rel="prefetch" href="/assets/js/93.2cb21d01.js"><link rel="prefetch" href="/assets/js/94.03f91a3c.js"><link rel="prefetch" href="/assets/js/95.fa391b4b.js"><link rel="prefetch" href="/assets/js/96.e281c41d.js"><link rel="prefetch" href="/assets/js/97.0496b2af.js"><link rel="prefetch" href="/assets/js/98.4e5705e9.js"><link rel="prefetch" href="/assets/js/99.56cba6f3.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5203916d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">xxred's notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">.Net Core</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dotnet-core/dotnetcore/" class="nav-link">.Net Core</a></li><li class="dropdown-item"><!----> <a href="/dotnet-core/aspnetcore/" class="nav-link">Asp.Net Core</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end/nodejs/" class="nav-link">nodejs</a></li><li class="dropdown-item"><!----> <a href="/front-end/vuejs/" class="nav-link">vuejs</a></li><li class="dropdown-item"><!----> <a href="/front-end/iview/" class="nav-link">iview</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/programing-language/csharp/" class="nav-link">C#</a></li><li class="dropdown-item"><!----> <a href="/programing-language/powershell/" class="nav-link">PowerShell</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/character-coding/" class="nav-link">字符编码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operating-system/windows/" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/operating-system/linux/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dev-tool/visualstudio/" class="nav-link">Visual Studio</a></li><li class="dropdown-subitem"><a href="/dev-tool/visualstudio-code/" class="nav-link">Visual Studio Code</a></li></ul></li><li class="dropdown-item"><h4>文档工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/doc/docfx/" class="nav-link">DocFX</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/awesome-collection/" class="nav-link">资源收集</a></div> <a href="https://github.com/xxred/xxred.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">.Net Core</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dotnet-core/dotnetcore/" class="nav-link">.Net Core</a></li><li class="dropdown-item"><!----> <a href="/dotnet-core/aspnetcore/" class="nav-link">Asp.Net Core</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">前端</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end/nodejs/" class="nav-link">nodejs</a></li><li class="dropdown-item"><!----> <a href="/front-end/vuejs/" class="nav-link">vuejs</a></li><li class="dropdown-item"><!----> <a href="/front-end/iview/" class="nav-link">iview</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/programing-language/csharp/" class="nav-link">C#</a></li><li class="dropdown-item"><!----> <a href="/programing-language/powershell/" class="nav-link">PowerShell</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">编程基础</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/character-coding/" class="nav-link">字符编码</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operating-system/windows/" class="nav-link">Windows</a></li><li class="dropdown-item"><!----> <a href="/operating-system/linux/" class="nav-link">Linux</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>开发工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/dev-tool/visualstudio/" class="nav-link">Visual Studio</a></li><li class="dropdown-subitem"><a href="/dev-tool/visualstudio-code/" class="nav-link">Visual Studio Code</a></li></ul></li><li class="dropdown-item"><h4>文档工具</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tools/doc/docfx/" class="nav-link">DocFX</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/awesome-collection/" class="nav-link">资源收集</a></div> <a href="https://github.com/xxred/xxred.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>images</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docker/images/" class="sidebar-link">镜像制作</a></li><li><a href="/docker/images/appveyor.html" class="active sidebar-link">appveyor docker 镜像制作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docker/images/appveyor.html#为什么选择它" class="sidebar-link">为什么选择它</a></li><li class="sidebar-sub-header"><a href="/docker/images/appveyor.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/docker/images/appveyor.html#制作过程" class="sidebar-link">制作过程</a></li><li class="sidebar-sub-header"><a href="/docker/images/appveyor.html#制作-dockerfile" class="sidebar-link">制作 Dockerfile</a></li><li class="sidebar-sub-header"><a href="/docker/images/appveyor.html#运行及使用" class="sidebar-link">运行及使用</a></li><li class="sidebar-sub-header"><a href="/docker/images/appveyor.html#总结" class="sidebar-link">总结</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="appveyor-docker-镜像制作"><a href="#appveyor-docker-镜像制作" aria-hidden="true" class="header-anchor">#</a> appveyor docker 镜像制作</h1> <ul><li>appveyor 是由 asp.net core 开发的 CI/CD 产品，也是之前少数支持 windows 环境的 CI/CD 产品之一。由于容器技术发展极快，利用容器的能力，可轻松快速拉取所需各种环境。从这一点上看，各产品之间，个人感觉差异并不大，主要还是看各家侧重点。今天要提的，其实是它内部的 nuget feed 功能，即将它作为 nuget 包源</li></ul> <h2 id="为什么选择它"><a href="#为什么选择它" aria-hidden="true" class="header-anchor">#</a> 为什么选择它</h2> <ul><li>我们的目标是自托管一个私有 nuget 源，部署在服务器并且不是在内网，任何开发机通过公网 ip 可访问，并需要需要认证</li> <li><a href="https://docs.microsoft.com/zh-cn/nuget/hosting-packages/overview" target="_blank" rel="noopener noreferrer">此处<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>介绍了几款产品
<ul><li>Azure Artifacts 也可通过 Team Foundation Server 2017 以及更高版本获得。</li> <li>MyGet</li> <li>Inedo 的 ProGet</li> <li>NuGet 服务器，Inedo 的社区项目</li> <li>NuGet 服务器（开放源代码），与 Inedo 的 NuGet 服务器相似的开放源代码实现</li> <li>LiGet：在 docker 中 kestrel 上运行的 NuGet V2 服务器的开放源代码实现</li> <li>BaGet 构建与 ASP.NET Core 基础上的 NuGet V3 服务器的开源实现</li> <li>Sleet（开放源代码 NuGet V3 静态源生成器）</li> <li>JFrog 的 Artifactory。</li> <li>Sonatype 的 Nexus。</li> <li>JetBrains 的 TeamCity。</li></ul></li> <li>其中大部分不能自托管，需要买服务，一部分复杂难用，有的还不支持私有源访问认证</li> <li>符合要求的基本都是 CI/CD 产品中的 nuget 功能，其中 appveyor 是发现的最简单易用的</li></ul> <h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2> <ul><li>官网安装说明 https://www.appveyor.com/docs/server/</li> <li>官网提供 windows 和 linux 的两种安装方式，都是安装包，并没有 docker 方式，我们希望通过 docker 来安装部署，因此需要制作一个镜像</li> <li>这里给出制作好的地址 https://hub.docker.com/r/xxred/appveyor</li> <li>安装命令 <code>docker run --restart always --name appveyor -d -p 80:80 -v appveyor_config:/etc/opt/appveyor/server -v appveyor_data:/var/opt/appveyor/server xxred/appveyor</code></li></ul> <h2 id="制作过程"><a href="#制作过程" aria-hidden="true" class="header-anchor">#</a> 制作过程</h2> <ul><li>首先根据官方说明，使用 ubuntu18.04 镜像进行实验</li> <li><code>apt update &amp;&amp; apt install wget dpkg libcap2-bin</code>，wget 用来下载安装包，dpkg 用来安装 deb 软件包，libcap2-bin 则是安装包依赖的包</li> <li>如果嫌更新速度慢，可更换软件源，参考 https://www.jianshu.com/p/e5677ebd5341</li> <li>下载安装包 <code>wget https://www.appveyor.com/downloads/appveyor-server/7.0/linux/appveyor-server_7.0.2184_amd64.deb -O appveyor-server.deb</code></li> <li>一切准备就绪，执行<code>dpkg -i appveyor-server.deb</code>进行安装</li> <li>安装完成之后，如果是 ubuntu 物理机，那么应该已经自动注册服务运行了，但在容器里须得手动运行，执行命令<code>./opt/appveyor/server/appveyor-server</code></li> <li>这个时候会报缺少包的错误，或者是一个全局配置错误，所有的问题都可以通过安装缺失的包来解决</li> <li>appveyor 由 asp.net core 开发，镜像环境参考 https://docs.microsoft.com/en-us/dotnet/core/linux-prerequisites?tabs=netcore2x#supported-linux-versions 此处列举了运行 asp.net core 的系统及其需要安装的包</li> <li>asp.net core 自包含相关资料参考 https://github.com/dotnet/core/blob/master/Documentation/self-contained-linux-apps.md</li> <li>安装完 asp.net core 所依赖的包即可正常运行应用，此时测试完成</li> <li>将此容器打包成镜像即可</li></ul> <h2 id="制作-dockerfile"><a href="#制作-dockerfile" aria-hidden="true" class="header-anchor">#</a> 制作 Dockerfile</h2> <ul><li>Dockerfile 命令 https://docs.docker.com/engine/reference/builder/</li> <li>特别注意 dockerfile 指令<code>ADD</code>和<code>COPY</code>的区别 https://www.cnblogs.com/sparkdev/p/9573248.html</li> <li>大概分为以下几步：选择基础镜像、准备需要的文件、导出需要暴露的端口、卷设置、容器运行执行的命令</li> <li>首先是基础镜像选择 https://hub.docker.com/_/microsoft-dotnet-core-runtime-deps 这里可以找到合适的 asp.net core 环境，大多数需要的依赖均已安装，直接使用即可</li> <li>所以我们只需要下载安装包，然后进行安装，得到解压后的应用文件。这一步可以进行优化，参考<a href="https://www.jianshu.com/p/beef99160219" target="_blank" rel="noopener noreferrer">Ubuntu 下制作 Nginx deb 安装包<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，得到安装 deb 包运行的脚本，自行设置</li> <li>即通过<code>dpkg -e appveyor-server.deb</code>命令得到包的元数据，以<code>ubuntu18.04</code>镜像而不是微软提供的镜像作为基础镜像，可以较少需要安装的包，进一步减少镜像体积。通过执行 deb 的安装脚本，达到安装的目的。最后自行安装缺失的包即可。理论上可以在其他体积更小的镜像中运行，比如 alpine</li> <li>为了快速完成镜像制作，得到以下 Dockerfile，而没有进行其他优化</li></ul> <div class="language-Dockerfile extra-class"><pre class="language-text"><code>FROM ubuntu:18.04 as download
WORKDIR /tmp
RUN apt update
RUN apt install wget -y
RUN wget https://www.appveyor.com/downloads/appveyor-server/7.0/linux/appveyor-server_7.0.2184_amd64.deb -O appveyor-server.deb
FROM mcr.microsoft.com/dotnet/core/runtime-deps:2.2.5-bionic
RUN apt update
RUN apt install libcap2-bin -y
COPY --from=download /tmp/appveyor-server.deb /tmp/
RUN dpkg -i /tmp/appveyor-server.deb
RUN cd /tmp &amp;&amp; rm -f *
WORKDIR /opt/appveyor/server
EXPOSE 80 443
VOLUME [ &quot;/etc/opt/appveyor/server&quot; ]
VOLUME [ &quot;/var/opt/appveyor/server&quot; ]
ENTRYPOINT [ &quot;./appveyor-server&quot; ]
</code></pre></div><h2 id="运行及使用"><a href="#运行及使用" aria-hidden="true" class="header-anchor">#</a> 运行及使用</h2> <ul><li>执行命令安装 <code>docker run --restart always --name appveyor -d -p 80:80 -v appveyor_config:/etc/opt/appveyor/server -v appveyor_data:/var/opt/appveyor/server xxred/appveyor</code>，然后在浏览器访问，设置密码即可</li> <li>进到主页面，选择<code>Account</code>栏目，左边选项卡选择<code>Nuget</code>，稍等片刻即可看到账号级别的 NuGet feed 和相应 API key</li> <li>使用下面的命令推送一个 nuget 包进行测试，将 nuget 包源地址添加到 Nuget Source，选择该包源搜索包，即可看到弹窗要求进行验证，输入刚刚设置的账号密码即可</li></ul> <h2 id="总结"><a href="#总结" aria-hidden="true" class="header-anchor">#</a> 总结</h2> <ul><li>Nuget 包私有源作为公司内部包管理之一，可有效管理多个 dll，减轻升级 dll 的成本</li> <li>将更多功能独立成一个 dll，各系统按需引入，加快新系统搭建速度</li> <li>逐步建立公司公共基础库，常用业务库等，nuget 包管理发至关重要的作用</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/xxred/xxred.github.io/edit/master/docs/docker/images/appveyor.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面！</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">6/30/2019, 5:59:10 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docker/images/" class="prev router-link-active">
          镜像制作
        </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8290a16a.js" defer></script><script src="/assets/js/2.968fe051.js" defer></script><script src="/assets/js/43.5137f653.js" defer></script>
  </body>
</html>
