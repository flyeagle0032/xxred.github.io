(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{254:function(t,r,e){"use strict";e.r(r);var a=e(0),s=Object(a.a)({},function(){var t=this,r=t.$createElement,e=t._self._c||r;return e("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._v(" "),t._m(8),t._v(" "),t._m(9),e("ul",[e("li",[e("p",[t._v("基础步骤请参考"),e("a",{attrs:{href:"https://www.cnrancher.com/docs/rancher/v2.x/cn/overview/quick-start-guide/",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档"),e("OutboundLink")],1)])]),t._v(" "),t._m(10)]),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._v(" "),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),e("ul",[t._m(19),t._v(" "),e("li",[e("p",[e("a",{attrs:{href:"https://rancher.com/docs/rancher/v2.x/en/backups/backups/single-node-backups/",target:"_blank",rel:"noopener noreferrer"}},[t._v("官方备份相关文档"),e("OutboundLink")],1)])]),t._v(" "),t._m(20)]),t._v(" "),e("p",[t._v("docker run --volumes-from rancher-data-<DATE> -v $PWD:/backup alpine tar zcvf /backup/rancher-data-backup-<RANCHER_VERSION>-<DATE>.tar.gz /var/lib/rancher")]),t._v(" "),e("p",[t._v("<DATE>替换为日期 2019-03-14\n<RANCHER_VERSION>替换 rancher 版本为 v2.1.7")]),t._v(" "),t._m(21),t._v(" "),e("p",[t._v("docker run --volumes-from rancher-data-2019-03-14 -v $PWD:/backup alpine tar zcvf /backup/rancher-data-backup-v2.1.7-2019-03-14.tar.gz /var/lib/rancher")]),t._v(" "),t._m(22),t._v(" "),e("p",[t._v("docker ps 可看到容器列表，查看镜像名为 rancher 的一项找到名称\ndocker stop <RANCHER_CONTAINER_NAME>\n<RANCHER_CONTAINER_NAME>替换为容器名\ndocker stop rancher")]),t._v(" "),t._m(23),t._v(" "),e("p",[t._v("docker create --volumes-from <RANCHER_CONTAINER_NAME> --name rancher-data-<DATE> rancher/rancher:<RANCHER_CONTAINER_TAG>")]),t._v(" "),e("p",[t._v("<RANCHER_CONTAINER_NAME>替换为容器名 rancher\n<DATE>替换为日期 2019-03-14\n<RANCHER_CONTAINER_TAG>替换为镜像名后面的 tag 标签，没有则不填，连同冒号删掉")]),t._v(" "),e("p",[t._v("docker create --volumes-from rancher --name rancher-data-2019-03-14 rancher/rancher")]),t._v(" "),t._m(24),t._v(" "),e("p",[t._v("docker run --volumes-from rancher-data-<DATE> -v $PWD:/backup:z alpine tar zcvf /backup/rancher-data-backup-<RANCHER_VERSION>-<DATE>.tar.gz /var/lib/rancher")]),t._v(" "),e("p",[t._v("<DATE>替换为日期 2019-03-14\n<RANCHER_VERSION>替换为 rancher 版本 v2.1.7")]),t._v(" "),e("p",[t._v("docker run --volumes-from rancher-data-2019-03-14 -v $PWD:/backup:z alpine tar zcvf /backup/rancher-data-backup-v2.1.7-2019-03-14.tar.gz /var/lib/rancher")]),t._v(" "),t._m(25),t._v(" "),e("p",[t._v("输入 ls 命令查看文件，可以看到名字类似于 rancher-data-backup-<RANCHER_VERSION>-<DATE>.tar.gz 的文件")]),t._v(" "),t._m(26),t._v(" "),e("p",[t._v("将备份 tarball 移动到 Rancher Server 外部的安全位置。然后把 rancher-data-<DATE>容器删除")]),t._v(" "),e("p",[t._v("docker rm rancher-data-2019-03-14")]),t._v(" "),t._m(27),t._v(" "),e("p",[t._v("docker start rancher")]),t._v(" "),t._m(28),t._v(" "),e("p",[t._v("docker run --volumes-from <RANCHER_CONTAINER_NAME> -v $PWD:/backup "),e("br"),t._v('\nalpine sh -c "rm /var/lib/rancher/* -rf && '),e("br"),t._v("\ntar zxvf /backup/rancher-data-backup-<RANCHER_VERSION>-"),e("DATE",[t._v('.tar.gz"')])],1),t._v(" "),e("p",[t._v('docker run --volumes-from rancher -v $PWD:/backup \\\nalpine sh -c "rm /var/lib/rancher/* -rf && \\\ntar zxvf /backup/rancher-data-backup-v2.1.7-2019-03-14.tar.gz"')]),t._v(" "),t._m(29),t._v(" "),e("p",[t._v("https://blog.csdn.net/csdn_duomaomao/article/details/77684571")]),t._v(" "),t._m(30),t._v(" "),t._m(31)])},[function(){var t=this.$createElement,r=this._self._c||t;return r("h1",{attrs:{id:"企业级容器管理平台-rancher-介绍入门及如何备份数据"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#企业级容器管理平台-rancher-介绍入门及如何备份数据","aria-hidden":"true"}},[this._v("#")]),this._v(" 企业级容器管理平台 Rancher 介绍入门及如何备份数据")])},function(){var t=this.$createElement,r=this._self._c||t;return r("h2",{attrs:{id:"是什么"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#是什么","aria-hidden":"true"}},[this._v("#")]),this._v(" 是什么")])},function(){var t=this.$createElement,r=this._self._c||t;return r("ul",[r("li",[this._v("Rancher 是一个为 DevOps 团队提供的完整的 Kubernetes 与容器管理解决方案的开源的企业级容器管理平台。它解决了多 Kubernetes 集群管理、操作和安全的难题，同时为 DevOps 团队提供了运行容器化工作负载的管理工具")])])},function(){var t=this.$createElement,r=this._self._c||t;return r("h2",{attrs:{id:"为什么"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#为什么","aria-hidden":"true"}},[this._v("#")]),this._v(" 为什么")])},function(){var t=this.$createElement,r=this._self._c||t;return r("ul",[r("li",[this._v("docker 的使用其实很简单很方便，一条"),r("code",[this._v("docker run")]),this._v("命令就可以跑起一个服务，比如一个 web 系统、一个数据库。可能有的软件配置很复杂，但是用 docker 你可以一条命令就快速跑起来")]),this._v(" "),r("li",[this._v("生产中的跑在 docker 中的服务，跟平常方式部署的服务一样，也需要管理。部署、数据备份、升级、扩容，服务多了大了，还有服务发现、负载均衡等。如果手工操作，面对成千上百的服务，运维成本过大。于是有了 k8s，进行容器编排管理")]),this._v(" "),r("li",[this._v("Kubernetes 集群管理并不是那么容易， 而 Rancher 作为 Kubernetes 管理工具，它可以轻松部署新 K8S 集群，启动 EKS、GKE 和 AKS 集群，甚至导入现有的 Kubernetes 集群。")])])},function(){var t=this.$createElement,r=this._self._c||t;return r("h2",{attrs:{id:"怎么用"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#怎么用","aria-hidden":"true"}},[this._v("#")]),this._v(" 怎么用")])},function(){var t=this.$createElement,r=this._self._c||t;return r("ul",[r("li",[this._v("友好 ui 界面，傻瓜式操作，请看下文教程")])])},function(){var t=this.$createElement,r=this._self._c||t;return r("h2",{attrs:{id:"创建"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#创建","aria-hidden":"true"}},[this._v("#")]),this._v(" 创建")])},function(){var t=this.$createElement,r=this._self._c||t;return r("ul",[r("li",[this._v("本教程对应的版本是 2.17，网上很多是 1.x 的版本教程")]),this._v(" "),r("li",[this._v("注意不要占用 80 和 443 端口，rancher 内置的 nginx-ingress 默认使用的就是 80 和 443 端口，会造成端口冲突，导致 nginx-ingress 服务不正常")]),this._v(" "),r("li",[this._v("而且访问 rancher 的 8080 端口，重定向到 https 的连接，默认用的是 8443 端口，所以这些端口最好不要乱改")])])},function(){var t=this.$createElement,r=this._self._c||t;return r("div",{staticClass:"language-bash extra-class"},[r("pre",{pre:!0,attrs:{class:"language-bash"}},[r("code",[r("span",{pre:!0,attrs:{class:"token function"}},[this._v("sudo")]),this._v(" docker run -d --restart"),r("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("unless-stopped --name rancher -p 8080:80 -p 8443:443 rancher/rancher\n")])])])},function(){var t=this.$createElement,r=this._self._c||t;return r("li",[r("p",[this._v("创建完集群的过程可能是一两分钟，创建完成之后在所创建的集群菜单下会有 default 和 system 两个选项卡，平时我们的操作主要是在 default")])])},function(){var t=this.$createElement,r=this._self._c||t;return r("h2",{attrs:{id:"注册主机"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#注册主机","aria-hidden":"true"}},[this._v("#")]),this._v(" 注册主机")])},function(){var t=this.$createElement,r=this._self._c||t;return r("ul",[r("li",[this._v("注意服务器地址，如果使用了其他端口，要加端口，这里由于是重新修改的端口，改成 8080 了，但是图中配置还是默认 80 端口")])])},function(){var t=this.$createElement,r=this._self._c||t;return r("p",[r("img",{attrs:{src:"https://raw.githubusercontent.com/xxred/xxred.github.io/master/imgs/2019-03-14-16-19-29.png",alt:" "}})])},function(){var t=this.$createElement,r=this._self._c||t;return r("h2",{attrs:{id:"部署服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#部署服务","aria-hidden":"true"}},[this._v("#")]),this._v(" 部署服务")])},function(){var t=this.$createElement,r=this._self._c||t;return r("ul",[r("li",[this._v("集群创建完成，部署服务，仅是在 ui 界面简单配置一下即可，并且该服务还有重新部署、部署备份、回滚等功能。就是这么强大方便\n"),r("img",{attrs:{src:"https://raw.githubusercontent.com/xxred/xxred.github.io/master/imgs/2019-03-31-23-35-23.png",alt:" "}})])])},function(){var t=this.$createElement,r=this._self._c||t;return r("h2",{attrs:{id:"出现的问题"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#出现的问题","aria-hidden":"true"}},[this._v("#")]),this._v(" 出现的问题")])},function(){var t=this.$createElement,r=this._self._c||t;return r("ul",[r("li",[this._v("添加 ingress 后，一直初始化失败，经过排查，就是上述说的端口占用问题，如图\n"),r("img",{attrs:{src:"https://raw.githubusercontent.com/xxred/xxred.github.io/master/imgs/2019-03-14-14-47-07.png",alt:" "}})]),this._v(" "),r("li",[this._v("点击到 system 选项进去查看，可以看到 nginx-ingress 服务用的就是 80 和 443 端口，所以才会一直是初始化状态\n"),r("img",{attrs:{src:"https://raw.githubusercontent.com/xxred/xxred.github.io/master/imgs/2019-03-14-14-49-08.png",alt:" "}}),this._v(" "),r("img",{attrs:{src:"https://raw.githubusercontent.com/xxred/xxred.github.io/master/imgs/2019-03-14-14-49-39.png",alt:" "}})]),this._v(" "),r("li",[this._v("相关 issues https://github.com/rancher/rancher/issues/16172")])])},function(){var t=this.$createElement,r=this._self._c||t;return r("h2",{attrs:{id:"备份"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#备份","aria-hidden":"true"}},[this._v("#")]),this._v(" 备份")])},function(){var t=this.$createElement,r=this._self._c||t;return r("li",[r("p",[this._v("出现了上述问题，除了全部删除重建，还可以备份一下，修改端口重新部署，然后还原备份，可以趁机学习一下备份操作")])])},function(){var t=this.$createElement,r=this._self._c||t;return r("li",[r("p",[this._v("命令说明，通过"),r("code",[this._v("docker ps -a")]),this._v("查看所有容器，得到版本等相关信息")])])},function(){var t=this.$createElement,r=this._self._c||t;return r("h3",{attrs:{id:"_1-创建数据卷"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建数据卷","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.创建数据卷")])},function(){var t=this.$createElement,r=this._self._c||t;return r("h3",{attrs:{id:"_2-停止容器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-停止容器","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.停止容器")])},function(){var t=this.$createElement,r=this._self._c||t;return r("h3",{attrs:{id:"_3-创建数据容器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建数据容器","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.创建数据容器")])},function(){var t=this.$createElement,r=this._self._c||t;return r("h3",{attrs:{id:"_4-创建一个备份-tarball"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建一个备份-tarball","aria-hidden":"true"}},[this._v("#")]),this._v(" 4.创建一个备份 tarball")])},function(){var t=this.$createElement,r=this._self._c||t;return r("h3",{attrs:{id:"_5-运行结果"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-运行结果","aria-hidden":"true"}},[this._v("#")]),this._v(" 5.运行结果")])},function(){var t=this.$createElement,r=this._self._c||t;return r("h3",{attrs:{id:"_6-保存备份"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_6-保存备份","aria-hidden":"true"}},[this._v("#")]),this._v(" 6.保存备份")])},function(){var t=this.$createElement,r=this._self._c||t;return r("h3",{attrs:{id:"_7-启动-rancher"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_7-启动-rancher","aria-hidden":"true"}},[this._v("#")]),this._v(" 7.启动 rancher")])},function(){var t=this.$createElement,r=this._self._c||t;return r("h3",{attrs:{id:"恢复"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#恢复","aria-hidden":"true"}},[this._v("#")]),this._v(" 恢复")])},function(){var t=this.$createElement,r=this._self._c||t;return r("h2",{attrs:{id:"卸载清理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#卸载清理","aria-hidden":"true"}},[this._v("#")]),this._v(" 卸载清理")])},function(){var t=this.$createElement,r=this._self._c||t;return r("h2",{attrs:{id:"总结"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#总结","aria-hidden":"true"}},[this._v("#")]),this._v(" 总结")])},function(){var t=this.$createElement,r=this._self._c||t;return r("ul",[r("li",[this._v("官方的入门文档是图文式的，一步步来还是没什么问题的，但是小问题总会有，不熟悉的人很容易被坑。如何顺利排坑呢，还是需要熟悉相关知识，比如 k8s 命令，错误日志查看，nginx 负载均衡等，涉及知识面广。都不熟悉的话，出了问题便很难解决")])])}],!1,null,null,null);r.default=s.exports}}]);